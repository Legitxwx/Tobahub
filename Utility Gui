local Players = game:GetService("Players")
local player = Players.LocalPlayer
local Teams = game:GetService("Teams")
local setclipboard = setclipboard or toclipboard or function() end

local gui = Instance.new("ScreenGui")
gui.ResetOnSpawn = false
gui.DisplayOrder = 999
gui.Parent = player:WaitForChild("PlayerGui")

local toggle = Instance.new("TextButton", gui)
toggle.Size = UDim2.fromOffset(42,42)
toggle.Position = UDim2.fromScale(0.02,0.5)
toggle.Text = "â‰¡"
toggle.Font = Enum.Font.GothamBold
toggle.TextSize = 20
toggle.TextColor3 = Color3.new(1,1,1)
toggle.BackgroundColor3 = Color3.fromRGB(45,45,45)
toggle.Active = true
toggle.Draggable = true
Instance.new("UICorner",toggle).CornerRadius = UDim.new(1,0)

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.fromScale(0.75,0.75)
frame.Position = UDim2.fromScale(0.5,0.5)
frame.AnchorPoint = Vector2.new(0.5,0.5)
frame.BackgroundColor3 = Color3.fromRGB(22,22,22)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Visible = false
Instance.new("UICorner",frame).CornerRadius = UDim.new(0,10)

toggle.MouseButton1Click:Connect(function()
	frame.Visible = not frame.Visible
end)

local searchBox = Instance.new("TextBox", frame)
searchBox.Size = UDim2.new(1,-20,0,32)
searchBox.Position = UDim2.new(0,10,0,10)
searchBox.Font = Enum.Font.Code
searchBox.TextSize = 14
searchBox.TextColor3 = Color3.new(1,1,1)
searchBox.BackgroundColor3 = Color3.fromRGB(30,30,30)
searchBox.PlaceholderText = "Search"
searchBox.ClearTextOnFocus = false
Instance.new("UICorner",searchBox).CornerRadius = UDim.new(0,6)

local scroll = Instance.new("ScrollingFrame", frame)
scroll.Size = UDim2.new(1,-20,1,-90)
scroll.Position = UDim2.new(0,10,0,52)
scroll.CanvasSize = UDim2.new(0,0,0,0)
scroll.ScrollBarThickness = 8
scroll.BackgroundColor3 = Color3.fromRGB(18,18,18)
scroll.BorderSizePixel = 0
Instance.new("UICorner",scroll).CornerRadius = UDim.new(0,6)

local layout = Instance.new("UIListLayout", scroll)
layout.Padding = UDim.new(0,2)

local function button(x,t)
	local b = Instance.new("TextButton", frame)
	b.Size = UDim2.new(0.23,0,0,32) -- Adjusted to fit 4 buttons
	b.Position = UDim2.new(x,0,1,-36)
	b.Font = Enum.Font.GothamMedium
	b.TextSize = 13
	b.TextColor3 = Color3.new(1,1,1)
	b.BackgroundColor3 = Color3.fromRGB(40,40,40)
	b.Text = t
	Instance.new("UICorner",b).CornerRadius = UDim.new(0,6)
	return b
end

local searchBtn = button(0.02,"Search")
local refreshBtn = button(0.27,"Refresh")
local copyBtn = button(0.52,"Copy")
local dexBtn = button(0.77,"Dex")

local lastQuery

local function typeColor(o)
	if o:IsA("Folder") then return Color3.fromRGB(0,162,255)
	elseif o:IsA("Model") then return Color3.fromRGB(0,255,128)
	elseif o:IsA("Workspace") then return Color3.fromRGB(0,180,255)
	elseif o:IsA("ReplicatedStorage") then return Color3.fromRGB(0,200,255)
	elseif o:IsA("Team") then return Color3.fromRGB(0,255,220)
	elseif o:IsA("RemoteEvent") or o:IsA("RemoteFunction") then return Color3.fromRGB(191,0,255)
	else return nil end
end

local function highlightText(text,q)
	if q == "" then return text end
	local ltext = text:lower()
	local lq = q:lower()
	local result = ""
	local i = 1
	while true do
		local s,e = ltext:find(lq,i,true)
		if not s then
			result = result .. text:sub(i)
			break
		end
		result = result .. text:sub(i,s-1) .. "<font color='rgb(255,90,90)'>"..text:sub(s,e).."</font>"
		i = e+1
	end
	return result
end

local function runSearch(q)
	scroll:ClearAllChildren()
	scroll.CanvasSize = UDim2.new(0,0,0,0)
	if q == "" then return end
	task.spawn(function()
		local yOffset = 0
		for _,obj in ipairs(game:GetDescendants()) do
			local col = typeColor(obj)
			if col and obj.Name:lower():find(q:lower(),1,true) then
				local function recursive(o,d)
					local color = typeColor(o)
					if not color then return end
					local l = Instance.new("TextLabel")
					l.Size = UDim2.new(1,-8,0,18)
					l.Position = UDim2.new(0,0,0,yOffset)
					l.BackgroundTransparency = 1
					l.RichText = true
					l.TextXAlignment = Enum.TextXAlignment.Left
					l.Font = Enum.Font.Code
					l.TextSize = 14
					l.TextColor3 = color
					l.Text = string.rep("  ",d)..highlightText(o.Name,q).." ("..o.ClassName..")"
					l.Parent = scroll
					yOffset = yOffset + 18
					for _,c in ipairs(o:GetChildren()) do
						recursive(c,d+1)
					end
				end
				recursive(obj,0)
			end
		end
		for _,team in ipairs(Teams:GetChildren()) do
			if team.Name:lower():find(q:lower(),1,true) then
				local l = Instance.new("TextLabel")
				l.Size = UDim2.new(1,-8,0,18)
				l.Position = UDim2.new(0,0,0,yOffset)
				l.BackgroundTransparency = 1
				l.RichText = true
				l.TextXAlignment = Enum.TextXAlignment.Left
				l.Font = Enum.Font.Code
				l.TextSize = 14
				l.TextColor3 = Color3.fromRGB(0,255,220)
				l.Text = highlightText(team.Name,q).." ("..team.ClassName..")"
				l.Parent = scroll
				yOffset = yOffset + 18
			end
		end
		scroll.CanvasSize = UDim2.new(0,0,0,yOffset)
	end)
end

searchBtn.MouseButton1Click:Connect(function()
	lastQuery = searchBox.Text
	runSearch(lastQuery)
end)

refreshBtn.MouseButton1Click:Connect(function()
	if lastQuery then runSearch(lastQuery) end
end)

copyBtn.MouseButton1Click:Connect(function()
	local t = {}
	for _,v in ipairs(scroll:GetChildren()) do
		if v:IsA("TextLabel") then
			table.insert(t,v.Text:gsub("<.->",""))
		end
	end
	if #t>0 then
		setclipboard(table.concat(t,"\n"))
		copyBtn.Text = "Copied"
		task.delay(1,function() copyBtn.Text = "Copy" end)
	end
end)

dexBtn.MouseButton1Click:Connect(function()
	pcall(function()
		loadstring(game:HttpGet("https://raw.githubusercontent.com/infyiff/backup/main/dex.lua"))()
	end)
end)
